<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Bottlefish's Notebook" name="description"/>
<link href="https://note.bottlefish.cc/mathematics/solidAngleEllipse/" rel="canonical"/>
<link href="../" rel="prev"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.14" name="generator"/>
<title>Solid Angle of Ellipse - Bottlefish's Notebook</title>
<link href="../../assets/stylesheets/main.342714a4.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link href="../../css/heti.css" rel="stylesheet"/>
<link href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css" rel="stylesheet"/>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
<body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#solid-angle-of-ellipse">
          跳转至
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="页眉" class="md-header__inner md-grid">
<a aria-label="Bottlefish's Notebook" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Bottlefish's Notebook">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 4v6l-2-2-2 2V4H9v16h10V4zM3 7V5h2V4a2 2 0 0 1 2-2h12c1.05 0 2 .95 2 2v16c0 1.05-.95 2-2 2H7c-1.05 0-2-.95-2-2v-1H3v-2h2v-4H3v-2h2V7zm2-2v2h2V5zm0 14h2v-2H5zm0-6h2v-2H5z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Bottlefish's Notebook
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Solid Angle of Ellipse
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-hidden="true" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="搜索" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="搜索" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="查找" class="md-search__options">
<button aria-label="清空当前内容" class="md-search__icon md-icon" tabindex="-1" title="清空当前内容" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/BottleFish326/notes/" title="前往仓库">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    BottleFish326/notes
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="标签" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../..">
        
  
  
    
  
  Home

      </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../">
          
  
  
    
  
  Mathematics

        </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="导航栏" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Bottlefish's Notebook" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Bottlefish's Notebook">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 4v6l-2-2-2 2V4H9v16h10V4zM3 7V5h2V4a2 2 0 0 1 2-2h12c1.05 0 2 .95 2 2v16c0 1.05-.95 2-2 2H7c-1.05 0-2-.95-2-2v-1H3v-2h2v-4H3v-2h2V7zm2-2v2h2V5zm0 14h2v-2H5zm0-6h2v-2H5z"></path></svg>
</a>
    Bottlefish's Notebook
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/BottleFish326/notes/" title="前往仓库">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    BottleFish326/notes
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    Home
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../">
<span class="md-ellipsis">
    Mathematics
    
  </span>
</a>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Mathematics
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_2_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    solidAngleEllipse
    
  </span>
</a>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_2_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_2">
<span class="md-nav__icon md-icon"></span>
            solidAngleEllipse
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="目录" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      目录
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-problem-description">
<span class="md-ellipsis">
      1. Problem Description
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-math-expression-needed">
<span class="md-ellipsis">
      2. Math Expression Needed
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-results">
<span class="md-ellipsis">
      3. Results
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="solid-angle-of-ellipse">Solid Angle of Ellipse<a class="headerlink" href="#solid-angle-of-ellipse" title="Permanent link">¶</a></h1>
<h2 id="1-problem-description">1. Problem Description<a class="headerlink" href="#1-problem-description" title="Permanent link">¶</a></h2>
<p>Calculate the (signed) solid angle for an ellipse from the origin <span class="arithmatex">\((0,0,0)\)</span></p>
<p>In short, complete the function s.t.
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="cm">/**</span>
<a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="cm"> * @brief Computes the solid angle for an ellipse from the origin(0,0,0)</span>
<a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="cm"> *</span>
<a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="cm"> * @param c Center of the ellipse. R^3</span>
<a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="cm"> * @param n Normal vector of the ellipse. R^3</span>
<a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="cm"> * @param d Direction of the long axis. R^3  ensure that &lt;n, d&gt; = 0</span>
<a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="cm"> * @param a Semi-major axis length of the ellipse. R</span>
<a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="cm"> * @param b Semi-minor axis length of the ellipse. R ensure that a &gt;= b &gt;= 0</span>
<a href="#__codelineno-0-9" id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="cm"> * @return The solid angle in steradians.</span>
<a href="#__codelineno-0-10" id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="cm"> */</span>
<a href="#__codelineno-0-11" id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="kt">double</span><span class="w"> </span><span class="nf">solid_angle_ellipse</span><span class="p">(</span>
<a href="#__codelineno-0-12" id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">c</span><span class="p">,</span>
<a href="#__codelineno-0-13" id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">n</span><span class="p">,</span>
<a href="#__codelineno-0-14" id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="w"> </span><span class="o">&amp;</span><span class="n">d</span><span class="p">,</span>
<a href="#__codelineno-0-15" id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">a</span><span class="p">,</span>
<a href="#__codelineno-0-16" id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">b</span>
<a href="#__codelineno-0-17" id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="p">);</span>
</code></pre></div>
<h2 id="2-math-expression-needed">2. Math Expression Needed<a class="headerlink" href="#2-math-expression-needed" title="Permanent link">¶</a></h2>
<blockquote>
<p><strong>reference paper</strong>: Analytical solution for the solid angle subtended at any point by an ellipse via a point source radiation vector potential
<a href="https://www.sciencedirect.com/science/article/abs/pii/S0168900209022918">https://www.sciencedirect.com/science/article/abs/pii/S0168900209022918</a></p>
</blockquote>
<h3 id="21-problem-simplify">2.1 Problem Simplify<a class="headerlink" href="#21-problem-simplify" title="Permanent link">¶</a></h3>
<p>We can assume that the Normal vector of the ellipse <span class="arithmatex">\(\textbf{n}\)</span> is parallel to the z-axis and the direction of the long axis <span class="arithmatex">\(\textbf{d}\)</span> is parallel to the x-axis, because it's easy to apply a coordinate transformation to satisfy this condition.</p>
<p>So, in the following expression, we assume that <span class="arithmatex">\(\textbf{n} = (0,0,1)\)</span> and <span class="arithmatex">\(\textbf{d} = (1,0,0)\)</span></p>
<p>Also, we assume that <span class="arithmatex">\(\textbf{c} = (p,q,h)\)</span></p>
<h3 id="22-special-case-where-textbfc-00h">2.2 Special case where <span class="arithmatex">\(\textbf{c} = (0,0,h)\)</span><a class="headerlink" href="#22-special-case-where-textbfc-00h" title="Permanent link">¶</a></h3>
<p>It's easy to calculate the solid angle using the eletric field. As we suppose a point charge is placed at the origin, and the soliet angle problem can be transformed into a calculation of the electric flux.</p>
<p>So the answer is
$$
\Omega(a, b, h) = 2\pi \left(1 - \Lambda_0(\beta, k)\right) \tag{57}
$$</p>
<p>where</p>
<div class="arithmatex">\[
\beta = \arcsin \sqrt{ \frac{h^2}{h^2 + b^2} } \tag{58}
\]</div>
<p>$$
k = \sqrt{\frac{a^2-b^2}{h^2+a^2}}
$$
and
$$
\Lambda_0(\beta,k) = \frac{2}{\pi}[\textbf{E}(k)F(\beta,k')+\textbf{K}(k)E(\beta,k)-\textbf{K}(k)F(\beta,k)]
$$
where $ k' \equiv \sqrt{1-k^2} $</p>
<h3 id="23-special-case-where-textbfc-p0h">2.3 Special case where <span class="arithmatex">\(\textbf{c} = (p,0,h)\)</span><a class="headerlink" href="#23-special-case-where-textbfc-p0h" title="Permanent link">¶</a></h3>
<p>We can apply a coordiante transformation such that, in the transformerd frame, the <span class="arithmatex">\(z'\)</span>-axis is aligned with the direction from the ellipse center to the observation point, and the <span class="arithmatex">\(x'\)</span> axis is aligned with the ellipse's major axis.</p>
<p>After this transformation, the resulting elliptical cone can be characterized by its new effective semi-axes, which can then be used to compute the solid angle.</p>
<p>And here's the new axis length after transformation.</p>
<div class="arithmatex">\[
\bar{a}^2 = a^2-h^2-p^2 + \sqrt{(p^2-a^2)^2+2h^2(p^2+a^2)+h^4}
\]</div>
<div class="arithmatex">\[
\bar{b}^2 = 2b^2
\]</div>
<div class="arithmatex">\[
\bar{h}^2 = h^2+p^2-a^2 + \sqrt{(p^2-a^2)^2+2h^2(p^2+a^2)+h^4}
\]</div>
<p>and then, we can apply the conclusion of <strong>Chapter 2.2</strong> to calculate the answer, but here's the point, in this occasion, we're not sure that if <span class="arithmatex">\(a &gt; b\)</span> or <span class="arithmatex">\(a &lt; b\)</span>, so, we should first swap <span class="arithmatex">\(a\)</span> and <span class="arithmatex">\(b\)</span> if <span class="arithmatex">\(a &lt; b\)</span> before apply the conclusion.</p>
<h3 id="24-general-solution">2.4 General Solution<a class="headerlink" href="#24-general-solution" title="Permanent link">¶</a></h3>
<h4 id="241-rotation-of-the-coordiante-system">2.4.1 Rotation of the coordiante system<a class="headerlink" href="#241-rotation-of-the-coordiante-system" title="Permanent link">¶</a></h4>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="/notes/assets/images/mathematics/solidAngleEllipse/elliptic_cone.png"><img alt="rotation" src="/notes/assets/images/mathematics/solidAngleEllipse/elliptic_cone.png"/></a>
In the <span class="arithmatex">\((x,y,z)\)</span> coordinate system, the sheared core obeys the equation
[
    \left(\frac{x}{a} - \frac{pz}{ah}\right)^2 +
    \left(\frac{y}{b} - \frac{qz}{bh}\right)^2 -
    \left(\frac{z}{h}\right) = 0
    \tag{117}
]</p>
<p>we need to rotate the coordinate system <span class="arithmatex">\((x,y,z)\)</span> to <span class="arithmatex">\((x',y',z')\)</span> where the <span class="arithmatex">\(z'\)</span> axis lies along the center line of the right elliptic cone.</p>
<p>This rotation need a right-handed rotation by an angle <span class="arithmatex">\(\gamma\)</span> about the <span class="arithmatex">\(y\)</span>-axis to give a new coordinate system <span class="arithmatex">\((\hat{x},\hat{y},\hat{z})\)</span> and a additional right-handed rotation by an angle <span class="arithmatex">\(\psi\)</span> about the <span class="arithmatex">\(\hat{x}\)</span> axis to give the new coordinate system <span class="arithmatex">\((x',y',z')\)</span></p>
<p>Then, we get
$$
  \begin{bmatrix}
   x'\
   y'\
   z'
  \end{bmatrix} =
  \begin{bmatrix}
  1 &amp; 0 &amp; 0 \
  0 &amp; \cos\psi &amp; \sin\psi \
  0 &amp; -\sin\psi &amp; \cos\psi
  \end{bmatrix}
  \begin{bmatrix}
  \cos\gamma &amp; 0 &amp; -\sin\gamma \
  0 &amp; 1 &amp; 0 \
  \sin\gamma &amp; 0 &amp; \cos\gamma
  \end{bmatrix}
  \begin{bmatrix}
  x \
  y \
  z
  \end{bmatrix}
  \tag{119}
$$</p>
<p>Substituting Eq.(119) into Eq.(117), expanding and collecting terms gives
$$
A_1x'^2 + B_1x'y' + C_1y'^2+D_1x'+E_1y'=F_1
\tag{121}
$$
where
$$
A_1 = \frac{1}{a^2} + A \sin^2\gamma + B \sin 2\gamma \tag{122}
$$</p>
<div class="arithmatex">\[
B_1 = 2C \sin\gamma \cos\psi - 2B \cos 2\gamma \sin\psi - A \sin 2\gamma \sin\psi \tag{123}
\]</div>
<div class="arithmatex">\[
C_1 = \frac{\sin^2 \psi}{a^2} + \frac{\cos^2 \psi}{b^2} - B \sin 2\gamma \sin^2 \psi - C \cos\gamma \sin 2\psi + A \cos^2\gamma \sin^2 \psi \tag{124}
\]</div>
<div class="arithmatex">\[
D_1 = -(A \sin 2\gamma \cos\psi + 2B \cos 2\gamma \cos\psi + 2C \sin\gamma \sin\psi) z' \tag{125}
\]</div>
<div class="arithmatex">\[
E_1 = \left(D \sin 2\psi - B \sin 2\gamma \sin 2\psi + A \cos^2 \gamma \sin 2\psi - 2C \cos\gamma \cos 2\psi \right) z' \tag{126}
\]</div>
<div class="arithmatex">\[
F_1 = \left( B \sin 2\gamma \cos^2 \psi - \frac{\cos^2 \psi}{a^2} - \frac{\sin^2 \psi}{b^2} - A \cos^2 \gamma \cos^2 \psi - C \cos\gamma \sin 2\psi
\right) z'^2 \tag{127}
\]</div>
<p>and where
$$
A = \frac{p^2}{a^2 h^2} + \frac{q^2}{b^2 h^2} - \frac{1}{a^2} - \frac{1}{h^2} \tag{128}
$$</p>
<div class="arithmatex">\[
B = \frac{p h}{a^2 h^2} \tag{129}
\]</div>
<div class="arithmatex">\[
C = \frac{q h}{b^2 h^2} \tag{130}
\]</div>
<div class="arithmatex">\[
D = \frac{1}{a^2} - \frac{1}{b^2} \tag{131}
\]</div>
<h4 id="242-solution-for-the-rotation-angle">2.4.2  Solution for the rotation angle<a class="headerlink" href="#242-solution-for-the-rotation-angle" title="Permanent link">¶</a></h4>
<p>For the <span class="arithmatex">\(z'\)</span> axis to lie along the axis of the cone, the coefficients <span class="arithmatex">\(D_1\)</span> and <span class="arithmatex">\(E_1\)</span> must vanish simultaneously and hence
$$
A \sin 2\gamma + 2B \cos 2\gamma + 2C \sin\gamma \tan\psi = 0 \tag{132}
$$</p>
<div class="arithmatex">\[
\left(D - B \sin 2\gamma + A \cos^2 \gamma \right) \tan 2\psi - 2C \cos\gamma = 0 \tag{133}
\]</div>
<p>After solving the system of equations, we get
$$
\gamma_j = \arctan(w_j) \tag{147}
$$</p>
<div class="arithmatex">\[
\psi_j = -\arctan\left( \frac{A \sin 2\gamma_j + 2B \cos 2\gamma_j}{2C \sin \gamma_j} \right) \tag{148}
\]</div>
<p>where <span class="arithmatex">\(w_j\)</span>, <span class="arithmatex">\(j \in {1,2,3}\)</span> is the three roots of the function
$$
w^3 - \left( \frac{A}{B} + \frac{B}{D} + \frac{C^2}{BD} \right) w^2 + \left( \frac{A}{D} - 1 \right) w + \frac{B}{D} = 0 \tag{140}
$$</p>
<blockquote>
<p>it is proved from the geometry that all three roots are real number.</p>
</blockquote>
<p>only one root that satisfied <span class="arithmatex">\(B_1^2-4A_1C_1 &lt; 0\)</span> is the correct root that needed.</p>
<h4 id="243-equation-of-the-ellipse-in-canonical-form">2.4.3 Equation of the ellipse in canonical form<a class="headerlink" href="#243-equation-of-the-ellipse-in-canonical-form" title="Permanent link">¶</a></h4>
<p>The value of <span class="arithmatex">\(z'\)</span> in Eq.(127) for <span class="arithmatex">\(F_1\)</span> is arbitrary and can be conveniently set to unity.</p>
<p>Since <span class="arithmatex">\(E_1\)</span> and <span class="arithmatex">\(F_1\)</span> is zero now, we can apply another right-handed rotation by an angle <span class="arithmatex">\(\lambda\)</span> about the <span class="arithmatex">\(z'\)</span> axis to set <span class="arithmatex">\(B_1\)</span> to zero.</p>
<p>We denoting the new rotated coordinates by <span class="arithmatex">\((\bar{x},\bar{y},\bar{z})\)</span>, then do the same steps of the previous part.</p>
<p>Then, we can get the final equation of the ellipse in the form
$$
A_2\bar{x}^2+C_2\bar{y}^2=F_1
\tag{156}
$$
where
$$
A_2 = \frac{A_1 + C_1 + \operatorname{sgn}(A_1 - C_1) \sqrt{B_1^2 + (A_1 - C_1)^2}}{2} \tag{157}
$$</p>
<p>and</p>
<div class="arithmatex">\[
C_2 = \frac{A_1 + C_1 - \operatorname{sgn}(A_1 - C_1) \sqrt{B_1^2 + (A_1 - C_1)^2}}{2} \tag{158}
\]</div>
<p>as the equation of Eq.(57), we can get the <strong>final solid angle</strong> which is equal to 
$$
\Omega \left( \sqrt{\frac{F_1}{A_2}}, \sqrt{\frac{F_1}{C_2}} \right)
$$</p>
<h2 id="3-results">3. Results<a class="headerlink" href="#3-results" title="Permanent link">¶</a></h2>
<h3 id="31-time-complexity">3.1 time Complexity<a class="headerlink" href="#31-time-complexity" title="Permanent link">¶</a></h3>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="/notes/assets/images/mathematics/solidAngleEllipse/runtime_vs_n.png"><img alt="time" src="/notes/assets/images/mathematics/solidAngleEllipse/runtime_vs_n.png"/></a></p>
<p>The horizontal axis repersents the number of triangles used to divide the ellipse in the numerical intergration, while the vertical axis shows the average time required to compute the solid angle. The orange curve correspoinds to the numerical-integration approach, whereas the red dashed line denotes the analytical formula(<span class="arithmatex">\(1.9123\mu s\)</span>).</p>
<h3 id="32-computational-error">3.2 computational error<a class="headerlink" href="#32-computational-error" title="Permanent link">¶</a></h3>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="80%" href="/notes/assets/images/mathematics/solidAngleEllipse/error_vs_n.png"><img alt="err" src="/notes/assets/images/mathematics/solidAngleEllipse/error_vs_n.png"/></a>
<strong>The error was determined by comparing our results with those reported in the paper, which are accurate to 20 significant digits</strong>
The horizontal axis repersents the number of triangles used to divide the ellipse in the numerical intergration, while the vertical axis shows the average error in the calculated solid angle. The orange curve correspoinds to the numerical-integration approach, whereas the red dahed line denotes the analytical formula(<span class="arithmatex">\(9.20974e-15\)</span>).</p>
<p><strong>summery table</strong></p>
<table>
<thead>
<tr>
<th>N</th>
<th>Time (μs)</th>
<th>Error</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>0.0798565</td>
<td>8.52715e-01</td>
</tr>
<tr>
<td>2</td>
<td>0.101816</td>
<td>6.97061e-01</td>
</tr>
<tr>
<td>4</td>
<td>0.144651</td>
<td>4.03314e-01</td>
</tr>
<tr>
<td>8</td>
<td>0.247237</td>
<td>9.64311e-02</td>
</tr>
<tr>
<td>16</td>
<td>0.426442</td>
<td>2.40481e-02</td>
</tr>
<tr>
<td>32</td>
<td>0.814843</td>
<td>3.64688e-03</td>
</tr>
<tr>
<td>64</td>
<td>1.57491</td>
<td>7.55273e-05</td>
</tr>
<tr>
<td><strong>analytical fomula</strong></td>
<td><strong>1.9123</strong></td>
<td><strong>9.20974e-15</strong></td>
</tr>
<tr>
<td>128</td>
<td>3.22987</td>
<td>1.14700e-07</td>
</tr>
<tr>
<td>256</td>
<td>6.43509</td>
<td>5.02762e-13</td>
</tr>
<tr>
<td>512</td>
<td>13.982</td>
<td>6.69005e-16</td>
</tr>
<tr>
<td>1024</td>
<td>24.3732</td>
<td>1.48253e-15</td>
</tr>
<tr>
<td>2048</td>
<td>48.5727</td>
<td>8.52766e-16</td>
</tr>
<tr>
<td>4096</td>
<td>107.324</td>
<td>2.98612e-15</td>
</tr>
<tr>
<td>8192</td>
<td>196.24</td>
<td>3.20553e-15</td>
</tr>
</tbody>
</table>
<h3 id="33-accelerate">3.3 accelerate<a class="headerlink" href="#33-accelerate" title="Permanent link">¶</a></h3>
<p>if we disable the elliptic integral promotion to long double, we can get the table following
| n    | Time (μs)  | Error              |
|------|------------|--------------------|
| 1    | 0.0564791  | 8.22507e-01        |
| 2    | 0.0774804  | 1.13996e+00        |
| 4    | 0.126105   | 3.63865e-01        |
| 8    | 0.223437   | 1.16768e-01        |
|<strong>analytical fomula</strong>|<strong>0.314463</strong>| <strong>9.25467e-15</strong>|
| 16   | 0.413136   | 2.40539e-02        |
| 32   | 0.763126   | 3.72579e-03        |
| 64   | 1.57758    | 7.52979e-05        |
| 128  | 3.1183     | 1.14699e-07        |
| 256  | 6.22602    | 5.03033e-13        |
| 512  | 13.5295    | 8.50134e-16        |
| 1024 | 24.4535    | 1.18320e-15        |
| 2048 | 49.7387    | 1.77492e-15        |
| 4096 | 127.653    | 2.76455e-15        |
| 8192 | 209.726    | 3.45533e-15        |</p>
<p>if we disable the elliptic integral promotion to double, we can get the table following.
But for some extreme samples, analytical fomula error would goto <strong>1e-5</strong>, which will maybe not be accpeted.
| n    | Time (μs)  | Error              |
|------|------------|--------------------|
| 1    | 0.050011   | 8.22507e-01        |
| 2    | 0.0698501  | 1.13996e+00        |
| 4    | 0.134739   | 3.63865e-01        |
|<strong>analytical fomula</strong>|<strong>0.186762</strong>| <strong>5.19641e-07</strong>|
| 8    | 0.230931   | 1.16768e-01        |
| 16   | 0.435317   | 2.40539e-02        |
| 32   | 0.826416   | 3.72579e-03        |
| 64   | 1.66177    | 7.52979e-05        |
| 128  | 3.26956    | 1.14699e-07        |
| 256  | 6.37945    | 5.03033e-13        |
| 512  | 12.6507    | 8.50134e-16        |
| 1024 | 24.9748    | 1.18320e-15        |
| 2048 | 50.179     | 1.77492e-15        |
| 4096 | 100.874    | 2.76455e-15        |
| 8192 | 202.717    | 3.45533e-15        |</p>
<aside class="md-source-file">
<span class="md-source-file__fact">
<span class="md-icon" title="最后更新">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"></path></svg>
</span>
<span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime" title="2025年6月23日 11:41:35 CST">2025年6月23日 11:41:35</span>
</span>
<span class="md-source-file__fact">
<span class="md-icon" title="创建日期">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"></path></svg>
</span>
<span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime" title="2025年6月23日 11:41:35 CST">2025年6月23日 11:41:35</span>
</span>
</aside>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  回到页面顶部
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["content.code.annotate", "navigation.tracking", "navigation.tabs", "navigation.indexes", "navigation.top"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
<script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<script src="../../js/katex.js"></script>
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>